## Запуск приложения

Чтобы развернуть приложение можно воспользоваться одним из двух способов:

- [Через Docker](#разворачивание-через-docker)
- [Локально](#локальное-разворачивание)

Используемый стек:

- PHP 8.1+
- Laravel
- PostgreSQL
- RabbitMQ

### Интерфейс приложения

#### — Users

Содержит информацию о пользователях и их балансе.

#### — Actions

Страница с основными действиями над балансом пользователя:

- Add - пополнение счёта
- Subtract - списание счёта
- Transfer - перевод от пользователя к пользователю

> При списании счёта можно установить флаг `Frozen`, что пометит транзакцию как необходимую в подтверждении. Само подтверждение осуществляется на странице **Transactions**.

#### — Transactions

Содержит полную информацию о транзакциях и их статусе. Именно с этой страницы осуществляется подтверждение "замороженных" средств или их возврат. 

#### — Logs

Отображение лога файла событий. 

> В ТЗ был такой пункт `После проведения любой из этих операций генерируется событие`.
> Т.к. никаких уточнений не было, реализовал самым простым способом - логированием в файл.

## Разворачивание через Docker

Вся работа с Docker выведена в make-файл.

### Шаги для запуска

1. Запустить сборку образа: `make start` (**дождаться запуска!**)
2. Запустить миграции и сидеры: `make migrate_fresh`
3. Запустить воркер по созданию транзакций: `make run_storekeeper_worker`
4. Запустить воркер по обработке транзакций: `make run_handler_worker`

> Если будут конфликты с пересечением портов, то изменить их в файле `docker-compose.yml`

### Доступные линки по умолчанию

- [http://localhost:8009/](http://localhost:8009/) - само приложение
- [http://localhost:15679/](http://localhost:15679/) - сервис RabbitMQ (guest:guest)

### Доступные make-команды

- `make env` - пересоздаёт файл конфигурации из .env.example
- `make start` - запускает контейнер
- `make start_rebuild` - запускает контейнер с пересборкой образа
- `make stop` - останавливает контейнер
- `make restart` - перезапускает контейнер
- `make migrate_fresh` - перенакатывает миграции и сидеры
- `make run_storekeeper_worker` - запускает воркер по созданию транзакций
- `make run_handler_worker` - запускает воркер по обработке транзакций

## Локальное разворачивание

Сначала необходимо создать файл конфигурации:

```
cp .env.example .env
```

Настроить следующие параметры:

- Подключение к БД (Нужен **PostgreSQL!**)
- Подключение к RabbitMQ

Установить зависимости:

```
composer install
```

Запустить миграции и сидеры:

```
php artisan migrate --seed
```

Запустить воркер по созданию транзакций:

```
php artisan rabbitmq:storekeeper-worker
```

Запустить воркер по обработке транзакций:

```
php artisan rabbitmq:handler-worker
```
Ну и открыть приложение через браузер.